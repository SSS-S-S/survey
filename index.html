<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>高中生生活調查（Apps Script 版）</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --odd-level: #e1e1e1;
            --even-level: #303030;
            --odd-level-hover: #d2d2d2;
            --even-level-hover: #414141;
            --place-hoder: #acacac;
        }
        * { font-family: 'Noto Sans TC', sans-serif; font-size: 16px; box-sizing: border-box; }
        body { margin:0; padding:0; background:var(--odd-level); }
        main { min-height:100vh; padding:30px; }
        form { width: 90%; max-width: 900px; margin: 0 auto; padding: 30px; border-radius:10px; background:var(--even-level); color:var(--odd-level); }
        h1 { margin:0 0 10px 0; font-size:24px; color:var(--odd-level); }
        ul { color: var(--odd-level); margin: 8px 0 16px 18px; }
        .page { display:flex; flex-direction:column; gap:12px; }
        .invisible { display:none; }
        .question { padding:12px; border-radius:8px; background:var(--odd-level); color:var(--even-level); transition: all .25s; }
        .question:hover { background: var(--odd-level-hover); }
        .radio-set, .checkbox-set { display:flex; gap:12px; margin-top:8px; flex-wrap:wrap; }
        .radio, .checkbox { padding:6px 10px; border-radius:8px; background:var(--even-level); color:var(--odd-level); display:flex; align-items:center; gap:8px; }
        input[type="radio"], input[type="checkbox"] { display:none; }
        input[type="radio"]:checked + .radio, input[type="checkbox"]:checked + .checkbox { background:var(--odd-level); color:var(--even-level); border:2px solid var(--even-level); }
        input[type="text"], input[type="number"] { width:100%; padding:6px 10px; border-radius:8px; border:0; outline:0; background:var(--even-level); color:var(--odd-level); margin-top:8px; height:34px; }
        input::placeholder { color:var(--place-hoder); }
        .number-set { display:flex; gap:8px; align-items:center; margin-top:8px; }
        .button-set { display:flex; gap:12px; margin-top:12px; }
        .button-set button { flex:1; height:36px; border-radius:8px; border:0; background:var(--odd-level); color:var(--even-level); cursor:pointer; }
        .button-set button:disabled { opacity:0.6; cursor:not-allowed; }
        @media (max-width:640px) {
            form { padding:20px; }
            .radio-set, .checkbox-set { gap:8px; }
        }
    </style>
</head>
<body>
    <main>
        <!-- 隱藏的 iframe（fallback 用） -->
        <iframe id="hidden_iframe" name="hidden_iframe" style="display:none;"></iframe>

        <form id="surveyForm" method="post">
            <h1>高中生生活調查</h1>
            <div id="page-1" class="page">
                <ul>
                    <li>本問卷會詢問你的生活目前的生活習慣及看法以及時間分配。</li>
                    <li>每題均<b>不強制作答</b>，不想回答可直接略過。</li>
                </ul>
                <div class="button-set">
                    <button type="button" class="next" data-current-page="1">開始問卷調查</button>
                </div>
            </div>

            <div id="page-2" class="page invisible">
                <div class="question">以下部分為基本調查，不強制作答(1/5)。</div>

                <div class="question">
                    <div>你的<b>電子信箱</b>？(請仔細檢查確認是你自己的電子信箱)</div>
                    <input type="text" name="entry.419239799" placeholder="電子信箱">
                </div>

                <div class="question">
                    <div>你的<b>年級</b>是？</div>
                    <div class="radio-set">
                        <label>
                            <input type="radio" name="entry.585057591" value="高一">
                            <span class="radio">高一</span>
                        </label>
                        <label>
                            <input type="radio" name="entry.585057591" value="高二">
                            <span class="radio">高二</span>
                        </label>
                        <label>
                            <input type="radio" name="entry.585057591" value="高三">
                            <span class="radio">高三</span>
                        </label>
                    </div>
                </div>

                <div class="question">
                    <div>你的<b>性別</b>是？</div>
                    <div class="radio-set">
                        <label>
                            <input type="radio" name="entry.206825897" value="男">
                            <span class="radio">男</span>
                        </label>
                        <label>
                            <input type="radio" name="entry.206825897" value="女">
                            <span class="radio">女</span>
                        </label>
                        <label>
                            <input type="radio" name="entry.206825897" value="其他">
                            <span class="radio">其他</span>
                        </label>
                    </div>
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="2">上一頁</button>
                    <button type="button" class="next" data-current-page="2">下一頁</button>
                </div>
            </div>

            <div id="page-3" class="page invisible">
                <div class="question">以下部分將調查你對學校相關的事物的喜好度或看法。請仔細閱讀後作答。(2/5)</div>

                <div class="question">
                    <div>就目前來看，你喜歡<b>學校的生活</b>嗎？</div>
                    <div class="radio-set">
                        <span style="align-self:center;">不喜歡</span>
                        <label><input type="radio" name="entry.1660436719" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.1660436719" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.1660436719" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.1660436719" value="4"><span class="radio">4</span></label>
                        <span style="align-self:center;">喜歡</span>
                    </div>
                </div>

                <div class="question">
                    <div>呈上題，為什麼？</div>
                    <input type="text" name="entry.685150814" placeholder="敘述一下原因...">
                </div>

                <div class="question">
                    <div>你認為哪一個學科<b>最沒用</b>？(如果一定只能剛好選一個的話)</div>
                    <div class="radio-set">
                        <label><input type="radio" name="entry.1353215473" value="國文"><span class="radio">國文</span></label>
                        <label><input type="radio" name="entry.1353215473" value="數學"><span class="radio">數學</span></label>
                        <label><input type="radio" name="entry.1353215473" value="英文"><span class="radio">英文</span></label>
                        <label><input type="radio" name="entry.1353215473" value="自然"><span class="radio">自然</span></label>
                        <label><input type="radio" name="entry.1353215473" value="社會"><span class="radio">社會</span></label>
                    </div>
                </div>

                <div class="question">
                    <div>呈上題，為什麼？</div>
                    <input type="text" name="entry.1711942117" placeholder="敘述一下原因...">
                </div>

                <div class="question">
                    <div>你<b>最喜歡</b>哪個學科？(如果一定只能剛好選一個的話)</div>
                    <div class="radio-set">
                        <label><input type="radio" name="entry.974781420" value="國文"><span class="radio">國文</span></label>
                        <label><input type="radio" name="entry.974781420" value="數學"><span class="radio">數學</span></label>
                        <label><input type="radio" name="entry.974781420" value="英文"><span class="radio">英文</span></label>
                        <label><input type="radio" name="entry.974781420" value="自然"><span class="radio">自然</span></label>
                        <label><input type="radio" name="entry.974781420" value="社會"><span class="radio">社會</span></label>
                    </div>
                </div>

                <div class="question">
                    <div>呈上題，為什麼？</div>
                    <input type="text" name="entry.415474345" placeholder="敘述一下原因...">
                </div>

                <div class="question">
                    <div>你<b>最討厭</b>哪個學科？(如果一定只能剛好選一個的話)</div>
                    <div class="radio-set">
                        <label><input type="radio" name="entry.2097295835" value="國文"><span class="radio">國文</span></label>
                        <label><input type="radio" name="entry.2097295835" value="數學"><span class="radio">數學</span></label>
                        <label><input type="radio" name="entry.2097295835" value="英文"><span class="radio">英文</span></label>
                        <label><input type="radio" name="entry.2097295835" value="自然"><span class="radio">自然</span></label>
                        <label><input type="radio" name="entry.2097295835" value="社會"><span class="radio">社會</span></label>
                    </div>
                </div>

                <div class="question">
                    <div>呈上題，為什麼？</div>
                    <input type="text" name="entry.1370665011" placeholder="敘述一下原因...">
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="3">上一頁</button>
                    <button type="button" class="next" data-current-page="3">下一頁</button>
                </div>
            </div>

            <div id="page-4" class="page invisible">
                <div class="question">以下部分將調查你的時間使用。請仔細閱讀後作答。(3/5)</div>

                <div class="question">
                    <div>在近七日中，你每天<b>讀書</b>的平均時間大約是幾個小時？<br><small>此處的讀書<b>不包含在學校</b>的時間，但包含補習的時間，及自行在家讀書的時間。</small></div>
                    <input class="warp" type="number" name="entry.1049059317" placeholder="請輸入介於0-24的數字，可含小數點" min="0" max="24" step="0.1">
                </div>

                <div class="question">
                    <div>在近七日中，你每天<b>使用手機</b>的平均時間大約是幾個小時？</div>
                    <input class="warp" type="number" name="entry.1058711790" placeholder="請輸入介於0-24的數字，可含小數點" min="0" max="24" step="0.1">
                </div>

                <div class="question">
                    <div>在近七日中，你在課後有進行哪些活動？(複選)<br><small>只要你在這七天內有任何一次就算。</small></div>
                    <div class="checkbox-set">
                        <label><input type="checkbox" name="entry.1664715744" value="補習"><span class="checkbox">補習</span></label>
                        <label><input type="checkbox" name="entry.1664715744" value="打電動"><span class="checkbox">打電動</span></label>
                        <label><input type="checkbox" name="entry.1664715744" value="(不是被強制地)去運動"><span class="checkbox">(不是被強制地)去運動</span></label>
                        <label><input type="checkbox" name="entry.1664715744" value="看(長度約為5分鐘以上的)影片"><span class="checkbox">看(長度約為5分鐘以上的)影片</span></label>
                        <label><input type="checkbox" name="entry.1664715744" value="學習課外的東西(如鋼琴、畫畫)"><span class="checkbox">學習課外的東西(如鋼琴、畫畫)</span></label>
                        <label><input type="checkbox" name="entry.1664715744" value="滑短影音(如IG的Reels、Youtube的Shorts)"><span class="checkbox">滑短影音(如IG的Reels、Youtube的Shorts)</span></label>
                    </div>
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="4">上一頁</button>
                    <button type="button" class="next" data-current-page="4">下一頁</button>
                </div>
            </div>

            <div id="page-5" class="page invisible">
                <div class="question">以下部分將調查你平日與周末分別的睡眠情形。請仔細閱讀後以24小時制回答。(4/5)</div>

                <div class="question">
                    <div>在近七日的<b>平日</b>中，你平均幾點<b>起床</b>？</div>
                    <div class="number-set">
                        <input type="number" name="entry.1734437586_hour" placeholder="0-24" min="0" max="24">
                        <span>點</span>
                        <input type="number" name="entry.1734437586_minute" placeholder="0-59" min="0" max="59">
                        <span>分</span>
                    </div>
                </div>

                <div class="question">
                    <div>在近七日的<b>周末</b>中，你平均幾點<b>起床</b>？</div>
                    <div class="number-set">
                        <input type="number" name="entry.1266742742_hour" placeholder="0-24" min="0" max="24">
                        <span>點</span>
                        <input type="number" name="entry.1266742742_minute" placeholder="0-59" min="0" max="59">
                        <span>分</span>
                    </div>
                </div>

                <div class="question">
                    <div>在近七日的<b>平日</b>中，你平均幾點<b>睡覺</b>？</div>
                    <div class="number-set">
                        <input type="number" name="entry.508945036_hour" placeholder="0-24" min="0" max="24">
                        <span>點</span>
                        <input type="number" name="entry.508945036_minute" placeholder="0-59" min="0" max="59">
                        <span>分</span>
                    </div>
                </div>

                <div class="question">
                    <div>在近七日的<b>周末</b>中，你平均幾點<b>睡覺</b>？</div>
                    <div class="number-set">
                        <input type="number" name="entry.1067239527_hour" placeholder="0-24" min="0" max="24">
                        <span>點</span>
                        <input type="number" name="entry.1067239527_minute" placeholder="0-59" min="0" max="59">
                        <span>分</span>
                    </div>
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="5">上一頁</button>
                    <button type="button" class="next" data-current-page="5">下一頁</button>
                </div>
            </div>

            <div id="page-6" class="page invisible">
                <div class="question">以下部分將調查你對於自身時間使用的滿意程度。請依照提供的名詞選擇你對它的滿意程度。(5/5)</div>

                <div class="question">
                    <div>我的<b>休閒</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.1873933451" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.1873933451" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.1873933451" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.1873933451" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="question">
                    <div>我的<b>課業</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.330710040" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.330710040" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.330710040" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.330710040" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="question">
                    <div>我的<b>睡眠</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.1897970435" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.1897970435" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.1897970435" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.1897970435" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="question">
                    <div><b>學校時間安排</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.792135410" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.792135410" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.792135410" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.792135410" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="question">
                    <div>我的<b>手機使用</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.658661038" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.658661038" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.658661038" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.658661038" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="question">
                    <div><b>總體生活</b>狀況。</div>
                    <div class="radio-set">
                        <span>不滿意</span>
                        <label><input type="radio" name="entry.1416998670" value="1"><span class="radio">1</span></label>
                        <label><input type="radio" name="entry.1416998670" value="2"><span class="radio">2</span></label>
                        <label><input type="radio" name="entry.1416998670" value="3"><span class="radio">3</span></label>
                        <label><input type="radio" name="entry.1416998670" value="4"><span class="radio">4</span></label>
                        <span>滿意</span>
                    </div>
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="6">上一頁</button>
                    <button type="button" class="next" data-current-page="6">下一頁</button>
                </div>
            </div>

            <div id="page-7" class="page invisible">
                <div class="question">
                    <div>你已完成填答，有什麼話想說的嗎？</div>
                    <input type="text" name="entry.1579754512" placeholder="一些想對我說的話...">
                </div>

                <div class="button-set">
                    <button type="button" class="back" data-current-page="7">上一頁</button>
                    <button type="submit" id="submitBtn">提交</button>
                </div>
            </div>
        </form>
    </main>

    <script>
    (function () {
        // ====== 你要把這裡改成你 Apps Script 部署後的 Web App URL ======
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7GIecaLIbcqcnexRjn3OoRfaoaZ90bTxcYanLDBOR2mrjrYKKLYinbWfcAoTBazJUVA/exec';
        // ==================================================================

        // 換頁功能（維持原本邏輯）
        const nextPageEL = document.querySelectorAll(".next");
        const backPageEL = document.querySelectorAll(".back");
        nextPageEL.forEach(e => {
            e.addEventListener("click", () => {
                const currentPage = Number(e.getAttribute("data-current-page"));
                const currentPageE = document.getElementById(`page-${currentPage}`);
                const targetPageE = document.getElementById(`page-${currentPage + 1}`);
                if (targetPageE) {
                    currentPageE.classList.add("invisible");
                    targetPageE.classList.remove("invisible");
                    window.scrollTo({top:0, behavior:'instant'});
                }
            });
        });
        backPageEL.forEach(e => {
            e.addEventListener("click", () => {
                const currentPage = Number(e.getAttribute("data-current-page"));
                const currentPageE = document.getElementById(`page-${currentPage}`);
                const targetPageE = document.getElementById(`page-${currentPage - 1}`);
                if (targetPageE) {
                    currentPageE.classList.add("invisible");
                    targetPageE.classList.remove("invisible");
                    window.scrollTo({top:0, behavior:'instant'});
                }
            });
        });

        // 表單送出（先嘗試 fetch，若失敗則 fallback 到隱藏 iframe 的原生提交）
        const form = document.getElementById('surveyForm');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            // 鎖定按鈕
            const originalText = submitBtn.innerText;
            submitBtn.disabled = true;
            submitBtn.innerText = '資料傳送中...';

            // 將表單轉為 urlencoded 字串（simple request -> 減少 preflight）
            const formData = new FormData(form);
            const urlEncoded = new URLSearchParams();
            for (const pair of formData.entries()) {
                // Checkbox 多選的情況：FormData 已會包含多個相同 name 的 entry
                urlEncoded.append(pair[0], pair[1]);
            }

            // 嘗試透過 fetch 直接送給 Apps Script（若 Apps Script 設定允許，且回應有 CORS header，會成功）
            try {
                const resp = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: urlEncoded.toString(),
                    // credentials: 'omit' // 不送 cookie
                });

                // 若伺服器回傳 200-299，視為成功
                if (resp.ok) {
                    try {
                        // 若可讀取回應，優先讀取回應訊息（非必要）
                        // const text = await resp.text();
                    } catch (readErr) {
                        // 不能讀取回應（可能是 CORS 回應被限制），但請求仍可能已送達
                    }
                    alert('表單已成功送出（透過 Apps Script 轉發）！感謝您的填寫。');
                    window.location.reload();
                    return;
                } else {
                    // HTTP error，視為失敗，進入 fallback
                    console.warn('Apps Script 回應狀態非 2xx：', resp.status);
                    throw new Error('非 2xx 回應');
                }
            } catch (err) {
                // fetch 失敗（很可能是 CORS 或網路問題），改用 iframe 原生提交回退
                console.warn('fetch 發生錯誤，改用 iframe 提交：', err);

                // 保存原始 action/target，做完再還原
                const originalAction = form.getAttribute('action') || '';
                const originalTarget = form.getAttribute('target') || '';

                // 設成要送的 Apps Script URL，並指定隱藏 iframe 為目標
                form.setAttribute('action', APPS_SCRIPT_URL);
                form.setAttribute('target', 'hidden_iframe');

                // 原生 submit（這樣瀏覽器會以表單方式送，Google Apps Script 會收到完整欄位）
                form.submit();

                // 設定 fallback 的回復機制：5 秒後恢復按鈕與表單 action/target（避免卡死）
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.innerText = originalText;
                    // 還原 action/target
                    if (originalAction) form.setAttribute('action', originalAction);
                    else form.removeAttribute('action');
                    if (originalTarget) form.setAttribute('target', originalTarget);
                    else form.removeAttribute('target');
                    // 在大多數情況下，你的 Apps Script 已收到資料；可在 Apps Script 加入 logging 以確認
                    alert('已以表單提交的方式送出（隱藏 iframe）— 若仍未收到，請檢查 Apps Script 部署與權限設定。');
                }, 4500);

                return;
            }
        });
    })();
    </script>
</body>
</html>
